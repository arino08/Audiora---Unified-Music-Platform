{"ast":null,"code":"import _asyncToGenerator from \"/home/ariz/DEV/Audiora/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _defineProperty from \"/home/ariz/DEV/Audiora/frontend/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";\nimport { signal, computed } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./player.service\";\nimport * as i2 from \"./spotify-web-sdk.service\";\nimport * as i3 from \"./youtube-player.service\";\nimport * as i4 from \"@angular/common\";\nfunction NowPlayingPanelComponent_div_0_img_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"img\", 13);\n  }\n  if (rf & 2) {\n    const cur_r2 = i0.ɵɵnextContext().ngIf;\n    i0.ɵɵproperty(\"src\", cur_r2.image, i0.ɵɵsanitizeUrl);\n  }\n}\nfunction NowPlayingPanelComponent_div_0_span_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"\\u266A\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction NowPlayingPanelComponent_div_0_div_8_span_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 17);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const cur_r2 = i0.ɵɵnextContext(2).ngIf;\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r2.spotifyArtists(cur_r2).join(\", \"));\n  }\n}\nfunction NowPlayingPanelComponent_div_0_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 14)(1, \"span\", 15);\n    i0.ɵɵtext(2, \"Spotify\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, NowPlayingPanelComponent_div_0_div_8_span_3_Template, 2, 1, \"span\", 16);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const cur_r2 = i0.ɵɵnextContext().ngIf;\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.spotifyArtists(cur_r2).length);\n  }\n}\nfunction NowPlayingPanelComponent_div_0_div_9_span_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 20);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const cur_r2 = i0.ɵɵnextContext(2).ngIf;\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r2.youtubeChannel(cur_r2));\n  }\n}\nfunction NowPlayingPanelComponent_div_0_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 14)(1, \"span\", 18);\n    i0.ɵɵtext(2, \"YouTube\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, NowPlayingPanelComponent_div_0_div_9_span_3_Template, 2, 1, \"span\", 19);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const cur_r2 = i0.ɵɵnextContext().ngIf;\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.youtubeChannel(cur_r2));\n  }\n}\nfunction NowPlayingPanelComponent_div_0_div_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 21)(1, \"div\", 22);\n    i0.ɵɵelement(2, \"div\", 23);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 24)(4, \"span\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"span\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵstyleProp(\"width\", ctx_r2.progressPercent(), \"%\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r2.positionLabel());\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r2.durationLabel());\n  }\n}\nfunction NowPlayingPanelComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 2)(1, \"div\", 3)(2, \"div\", 4);\n    i0.ɵɵtemplate(3, NowPlayingPanelComponent_div_0_img_3_Template, 1, 1, \"img\", 5)(4, NowPlayingPanelComponent_div_0_span_4_Template, 2, 0, \"span\", 6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\", 7)(6, \"h3\", 8);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(8, NowPlayingPanelComponent_div_0_div_8_Template, 4, 1, \"div\", 9)(9, NowPlayingPanelComponent_div_0_div_9_Template, 4, 1, \"div\", 9);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(10, NowPlayingPanelComponent_div_0_div_10_Template, 8, 4, \"div\", 10);\n    i0.ɵɵelementStart(11, \"div\", 11)(12, \"button\", 12);\n    i0.ɵɵlistener(\"click\", function NowPlayingPanelComponent_div_0_Template_button_click_12_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.togglePlay());\n    });\n    i0.ɵɵtext(13);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"button\", 12);\n    i0.ɵɵlistener(\"click\", function NowPlayingPanelComponent_div_0_Template_button_click_14_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.next());\n    });\n    i0.ɵɵtext(15, \"Next\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const cur_r2 = ctx.ngIf;\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵclassProp(\"placeholder\", !cur_r2.image);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", cur_r2.image);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", !cur_r2.image);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(cur_r2.title);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.isSpotify(cur_r2));\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.isYouTube(cur_r2));\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.durationMs() > 0);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r2.playing() ? \"Pause\" : \"Play\");\n  }\n}\nfunction NowPlayingPanelComponent_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 25);\n    i0.ɵɵtext(1, \"Nothing playing\");\n    i0.ɵɵelementEnd();\n  }\n}\nexport let NowPlayingPanelComponent = /*#__PURE__*/(() => {\n  var _NowPlayingPanelComponent;\n  class NowPlayingPanelComponent {\n    constructor(player, spotifySdk, yt) {\n      _defineProperty(this, \"player\", void 0);\n      _defineProperty(this, \"spotifySdk\", void 0);\n      _defineProperty(this, \"yt\", void 0);\n      _defineProperty(this, \"interval\", void 0);\n      _defineProperty(this, \"positionMs\", signal(0));\n      _defineProperty(this, \"durationMs\", signal(0));\n      _defineProperty(this, \"playing\", computed(() => this.player.isPlaying()));\n      _defineProperty(this, \"current\", computed(() => this.player.current()));\n      this.player = player;\n      this.spotifySdk = spotifySdk;\n      this.yt = yt;\n      this.interval = setInterval(() => this.tick(), 1000);\n    }\n    ngOnDestroy() {\n      if (this.interval) clearInterval(this.interval);\n    }\n    isSpotify(p) {\n      return p?.provider === 'spotify';\n    }\n    isYouTube(p) {\n      return p?.provider === 'youtube';\n    }\n    tick() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        const cur = _this.player.current();\n        if (!cur) {\n          _this.positionMs.set(0);\n          _this.durationMs.set(0);\n          return;\n        }\n        if (cur.provider === 'spotify') {\n          const st = yield _this.spotifySdk.getState();\n          if (st) {\n            _this.positionMs.set(st.position || 0);\n            _this.durationMs.set(st.duration || cur.durationMs || 0);\n          }\n        } else if (cur.provider === 'youtube') {\n          const pos = _this.yt.getPositionSeconds() * 1000;\n          const dur = _this.yt.getDurationSeconds() * 1000;\n          if (!isNaN(pos)) _this.positionMs.set(pos);\n          if (!isNaN(dur)) _this.durationMs.set(dur);\n        }\n      })();\n    }\n    positionLabel() {\n      return this.formatTime(this.positionMs());\n    }\n    durationLabel() {\n      return this.formatTime(this.durationMs());\n    }\n    formatTime(ms) {\n      const total = Math.floor(ms / 1000);\n      const m = Math.floor(total / 60);\n      const s = total % 60;\n      return m + ':' + s.toString().padStart(2, '0');\n    }\n    spotifyArtists(p) {\n      return Array.isArray(p?.artists) ? p.artists : [];\n    }\n    youtubeChannel(p) {\n      return p?.channel || null;\n    }\n    togglePlay() {\n      if (this.player.isPlaying()) {\n        this.player.pause();\n      } else if (this.player.current()) {\n        const cur = this.player.current();\n        if (cur?.provider === 'spotify') {\n          // resume via backend endpoint triggered through AppComponent would be nicer; fallback: replay track\n          this.player.play(cur, false);\n        } else if (cur?.provider === 'youtube') {\n          // resume playback\n          this.yt.playVideo(cur.videoId, this.positionMs() / 1000);\n        }\n      }\n    }\n    next() {\n      this.player.next();\n    }\n    progressPercent() {\n      const d = this.durationMs();\n      return d > 0 ? this.positionMs() / d * 100 : 0;\n    }\n  }\n  _NowPlayingPanelComponent = NowPlayingPanelComponent;\n  _defineProperty(NowPlayingPanelComponent, \"\\u0275fac\", function NowPlayingPanelComponent_Factory(__ngFactoryType__) {\n    return new (__ngFactoryType__ || _NowPlayingPanelComponent)(i0.ɵɵdirectiveInject(i1.PlayerService), i0.ɵɵdirectiveInject(i2.SpotifyWebSdkService), i0.ɵɵdirectiveInject(i3.YouTubePlayerService));\n  });\n  _defineProperty(NowPlayingPanelComponent, \"\\u0275cmp\", /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: _NowPlayingPanelComponent,\n    selectors: [[\"audiora-now-playing-panel\"]],\n    standalone: true,\n    features: [i0.ɵɵStandaloneFeature],\n    decls: 2,\n    vars: 2,\n    consts: [[\"class\", \"now-playing panel\", 4, \"ngIf\"], [\"class\", \"panel empty small\", 4, \"ngIf\"], [1, \"now-playing\", \"panel\"], [1, \"np-header\"], [1, \"art\"], [\"alt\", \"artwork\", 3, \"src\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"meta\"], [1, \"title\"], [\"class\", \"sub\", 4, \"ngIf\"], [\"class\", \"progress-block\", 4, \"ngIf\"], [1, \"controls-row\"], [1, \"btn\", \"sm\", 3, \"click\"], [\"alt\", \"artwork\", 3, \"src\"], [1, \"sub\"], [1, \"provider-badge\", \"spotify\"], [\"class\", \"artists\", 4, \"ngIf\"], [1, \"artists\"], [1, \"provider-badge\", \"youtube\"], [\"class\", \"channel\", 4, \"ngIf\"], [1, \"channel\"], [1, \"progress-block\"], [1, \"bar\"], [1, \"fill\"], [1, \"times\"], [1, \"panel\", \"empty\", \"small\"]],\n    template: function NowPlayingPanelComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵtemplate(0, NowPlayingPanelComponent_div_0_Template, 16, 9, \"div\", 0)(1, NowPlayingPanelComponent_div_1_Template, 2, 0, \"div\", 1);\n      }\n      if (rf & 2) {\n        i0.ɵɵproperty(\"ngIf\", ctx.current());\n        i0.ɵɵadvance();\n        i0.ɵɵproperty(\"ngIf\", !ctx.current());\n      }\n    },\n    dependencies: [CommonModule, i4.NgIf],\n    styles: [\".now-playing[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.np-header[_ngcontent-%COMP%]{display:flex;gap:12px}.art[_ngcontent-%COMP%]{width:72px;height:72px;border-radius:8px;background:var(--color-surface-3,#222);display:flex;align-items:center;justify-content:center;font-size:28px}.art[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;border-radius:inherit}.meta[_ngcontent-%COMP%]{flex:1;min-width:0}.title[_ngcontent-%COMP%]{margin:0 0 4px;font-size:16px;line-height:1.2}.sub[_ngcontent-%COMP%]{font-size:12px;display:flex;gap:8px;flex-wrap:wrap;opacity:.85}.provider-badge[_ngcontent-%COMP%]{padding:2px 6px;border-radius:12px;font-size:10px;letter-spacing:.5px;background:#333;text-transform:uppercase}.provider-badge.spotify[_ngcontent-%COMP%]{background:#1db95422;color:#1db954}.provider-badge.youtube[_ngcontent-%COMP%]{background:#f002;color:#f55}.progress-block[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:4px}.times[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:10px;opacity:.7}input.progress[_ngcontent-%COMP%]{width:100%;cursor:pointer}.controls-row[_ngcontent-%COMP%]{display:flex;gap:8px}.btn[_ngcontent-%COMP%]{background:var(--color-surface-2,#2a2a2a);border:1px solid var(--color-border,#333);color:var(--color-text,#fff);padding:6px 12px;border-radius:6px;cursor:pointer;font:inherit}.btn[_ngcontent-%COMP%]:hover{background:var(--color-surface-3,#333)}.btn.sm[_ngcontent-%COMP%]{padding:4px 10px;font-size:12px}\"]\n  }));\n  return NowPlayingPanelComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}